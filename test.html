<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卡片接口测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-image: url('public/background.webp');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed;
            color: #ffffff; /* 设置默认文字为白色 */
        }
        .container {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #fff;
        }
        h3 {
            color: #ffffff; /* 副标题改为白色 */
        }
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card-item {
            background-color: rgba(255, 255, 255, 0.1); /* 背景改为半透明 */
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .card-item h3 {
            margin-top: 0;
            color: #ffffff; /* 标题改为白色 */
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); /* 边框改为半透明白色 */
            padding-bottom: 10px;
        }
        .name-card {
            max-width: 100%;
            height: auto;
            border: 1px solid rgba(255, 255, 255, 0.2); /* 边框改为半透明 */
            border-radius: 5px;
        }
        .loading {
            color: #68dfe7; /* 加载信息改为青色 */
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        .error {
            color: #ff6b6b; /* 错误信息改为浅红色 */
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }
        .name-text {
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
            color: #ffffff; /* 姓名文字改为白色 */
        }
        strong {
            color: #ffffff; /* 强调文字改为白色 */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>卡片接口测试</h1>
        <h3>此部分数据为请求边缘函数动态生成，用以测试功能是否正常</h3>
        <div class="cards-container" id="testResults">
        </div>
    </div>

    <script>
        // 测试用例数据
        const testCases = [
            { id: 1, japanese: "桜羽 エマ", roman: "Sakuraba Ema", chinese: "樱羽 艾玛", color: "fd91af" },
            { id: 2, japanese: "二階堂 ヒロ", roman: "Nikaidou Hiro", chinese: "二阶堂 希罗", color: "ef4f54" },
            { id: 3, japanese: "夏目 アンアン", roman: "Natsume Anan", chinese: "夏目 安安", color: "9f91fb" },
            { id: 4, japanese: "城ケ崎ノア", roman: "Jougasaki Noa", chinese: "城崎 诺亚", color: "68dfe7" },
            { id: 5, japanese: "蓮見 レイア", roman: "Hasumi Reia", chinese: "莲见 蕾雅", color: "fdb158" },
            { id: 6, japanese: "佐伯 ミリア", roman: "Saeki Miria", chinese: "佐伯 米莉亚", color: "ebcf8b" },
            { id: 7, japanese: "宝生 マーゴ", roman: "Houshou Maago", chinese: "宝生 玛格", color: "b97ceb" },
            { id: 8, japanese: "黒部 ナノカ", roman: "Kurobe Nanoka", chinese: "黑部 奈叶香", color: "838f93" },
            { id: 9, japanese: "紫藤 アリサ", roman: "Shitou Arisa", chinese: "紫藤 亚里沙", color: "eb4b3c" },
            { id: 10, japanese: "橘 シェリー", roman: "Tachibana Sherii", chinese: "橘 雪莉", color: "89b1fb" },
            { id: 11, japanese: "遠野 ハンナ", roman: "Toono Hanna", chinese: "远野 汉娜", color: "a9c71e" },
            { id: 12, japanese: "沢渡 ココ", roman: "Sawatari Koko", chinese: "泽渡 可可", color: "fb724e" },
            { id: 13, japanese: "氷上 メルル", roman: "Hikami Meruru", chinese: "冰上 梅露露", color: "e3b9af" }
        ];

        // 分离姓和名的辅助函数
        function splitName(japanese, roman, chinese) {
            // 日文姓名分离（假设第一部分是姓）
            const japaneseParts = japanese.split(' ');
            const lastNameJa = japaneseParts[0];
            const firstNameJa = japaneseParts.slice(1).join(' ');

            // 罗马音姓名分离（最后一个单词是名）
            const romanParts = roman.split(' ');
            const firstNameRo = romanParts.pop();
            const lastNameRo = romanParts.join(' ');

            // 中文姓名分离（第一个字符是姓）
            const chineseParts = chinese.split(' ');
            const lastNameCh = chineseParts[0];
            const firstNameCh = chineseParts[1];

            return {
                japanese: { last: lastNameJa, first: firstNameJa },
                roman: { last: lastNameRo, first: firstNameRo },
                chinese: { last: lastNameCh, first: firstNameCh }
            };
        }

        // 生成姓名卡片
        async function generateNameCard(lastName, firstName, color) {
            // 使用姓和名作为参数发送请求
            const params = new URLSearchParams({
                lastName: lastName,
                firstName: firstName,
                color: color // 金色
            });

            try {
                const response = await fetch(`/api/generate?${params}`);
                if (response.ok) {
                    const blob = await response.blob();
                    const imageUrl = URL.createObjectURL(blob);
                    return imageUrl;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                throw new Error(`请求失败: ${error.message}`);
            }
        }

        // 渲染所有测试用例
        async function renderTestCases() {
            const container = document.getElementById('testResults');
            
            for (const testCase of testCases) {
                const names = splitName(testCase.japanese, testCase.roman, testCase.chinese);
                
                // 创建卡片项
                const cardItem = document.createElement('div');
                cardItem.className = 'card-item';
                cardItem.innerHTML = `
                    <h3>${testCase.chinese}</h3>
                    <div id="cards-${testCase.id}">
                        <div class="loading">生成中...</div>
                    </div>
                `;
                container.appendChild(cardItem);

                try {
                    // 为每种语言生成姓名卡片
                    const japaneseImageUrl = await generateNameCard(names.japanese.last, names.japanese.first, testCase.color);
                    const romanImageUrl = await generateNameCard(names.roman.last, names.roman.first, testCase.color);
                    const chineseImageUrl = await generateNameCard(names.chinese.last, names.chinese.first, testCase.color);
                    
                    // 更新卡片显示
                    document.getElementById(`cards-${testCase.id}`).innerHTML = `
                        <div>
                            <p><strong>日文:</strong></p>
                            <img src="${japaneseImageUrl}" alt="日文姓名卡片" class="name-card">
                            <div class="name-text">${testCase.japanese}</div>
                        </div>
                        <div>
                            <p><strong>罗马音:</strong></p>
                            <img src="${romanImageUrl}" alt="罗马音姓名卡片" class="name-card">
                            <div class="name-text">${testCase.roman}</div>
                        </div>
                        <div>
                            <p><strong>中文:</strong></p>
                            <img src="${chineseImageUrl}" alt="中文姓名卡片" class="name-card">
                            <div class="name-text">${testCase.chinese}</div>
                        </div>
                    `;
                } catch (error) {
                    // 显示错误信息
                    document.getElementById(`cards-${testCase.id}`).innerHTML = 
                        `<div class="error">生成失败: ${error.message}</div>`;
                }
            }
        }

        // 页面加载完成后开始渲染测试用例
        document.addEventListener('DOMContentLoaded', renderTestCases);
    </script>
</body>
</html>